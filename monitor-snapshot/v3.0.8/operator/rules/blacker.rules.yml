groups:
- name: alert.rules
  rules:
  - alert: TiDB_server_is_down
    expr: probe_success{group="tidb"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="tidb"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: TiDB server is down
      value: '{{ $value }}'
  - alert: Pump_server_is_down
    expr: probe_success{group="pump"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="pump"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Pump server is down
      value: '{{ $value }}'
  - alert: Drainer_server_is_down
    expr: probe_success{group="drainer"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="drainer"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Drainer server is down
      value: '{{ $value }}'
  - alert: TiKV_server_is_down
    expr: probe_success{group="tikv"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="tikv"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: TiKV server is down
      value: '{{ $value }}'
  - alert: PD_server_is_down
    expr: probe_success{group="pd"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="pd"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: PD server is down
      value: '{{ $value }}'
  - alert: Node_exporter_server_is_down
    expr: probe_success{group="node_exporter"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="node_exporter"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Node_exporter server is down
      value: '{{ $value }}'
  - alert: Blackbox_exporter_server_is_down
    expr: probe_success{group="blackbox_exporter"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="blackbox_exporter"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Blackbox_exporter server is down
      value: '{{ $value }}'
  - alert: Grafana_server_is_down
    expr: probe_success{group="grafana"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="grafana"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Grafana server is down
      value: '{{ $value }}'
  - alert: Pushgateway_server_is_down
    expr: probe_success{group="pushgateway"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="pushgateway"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Pushgateway server is down
      value: '{{ $value }}'
  - alert: Kafka_exporter_is_down
    expr: probe_success{group="kafka_exporter"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{group="kafka_exporter"} == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Kafka_exporter server is down
      value: '{{ $value }}'
  - alert: Pushgateway_metrics_interface
    expr: probe_success{job="blackbox_exporter_http"} == 0
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: probe_success{job="blackbox_exporter_http"}  == 0
      level: emergency
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}'
      summary: Pushgateway metrics interface is down
      value: '{{ $value }}'
  - alert: BLACKER_ping_latency_more_than_1s
    expr: max_over_time(probe_duration_seconds{job=~"blackbox_exporter.*_icmp"}[1m])
      > 1
    for: 5m
    labels:
      env: ENV_LABELS_ENV
      expr: max_over_time(probe_duration_seconds{job=~"blackbox_exporter.*_icmp"}[1m])
        > 1
      level: warning
    annotations:
      description: 'cluster: ENV_LABELS_ENV, instance: {{ $labels.instance }}, values:
        {{ $value }}'
      summary: blackbox_exporter ping latency more than 1s
      value: '{{ $value }}'
